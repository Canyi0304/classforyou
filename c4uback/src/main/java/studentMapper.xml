<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mybatis.StudentMapper">

<!-- 회원 전체 조회-->
<select resultType="com.my.vo.Student" id="selectStudentList">
SELECT student_email, student_name, student_phone, 
CASE WHEN student_status = 1 THEN 'O' 
WHEN student_status = 0 OR student_status =2  THEN 'X' END AS 회원상태, 
(SELECT COUNT(*) 
FROM penalty_status 
WHERE ps_student_id = student_id) 경고횟수 
FROM student;
</select>

<!-- 회원 검색-->
<select resultType="com.my.vo.Student" id="selectByEmailOrNameOrPhone ParameterType="java.lang.String">
SELECT student_email, student_name, student_phone, 
CASE WHEN student_status = 1 THEN 'O' 
WHEN student_status = 0 OR student_status =2 THEN 'X' END AS 회원상태, 
(SELECT COUNT(*) 
FROM penalty_status 
WHERE ps_student_id = student_id) 경고횟수 
FROM student
WHERE student_email LIKE '%${value}%' 
OR student_name LIKE '%${value}%' 
OR student_phone LIKE '%${value}%';
</select>

<!--탈퇴 처리-->
<update id="updateStatus" parameterType="java.lang.Integer">
UPDATE student
SET student_status = 2  
WHERE student_id =  #{student_id};
</update>


</mapper>


